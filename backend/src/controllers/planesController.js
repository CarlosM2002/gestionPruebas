import pool from '../config/db.js';
export async function createPlan(req,res){ try{ const {IdTester,Descripcion,FechaEjecucion}=req.body; const q=await pool.query('INSERT INTO "planDoPrueba" ("IdTester","Descripcion","FechaEjecucion") VALUES ($1,$2,$3) RETURNING *',[IdTester,Descripcion,FechaEjecucion]); res.status(201).json(q.rows[0]); }catch(e){console.error(e);res.status(500).json({message:'Error creando plan'})} }
export async function addCasoToPlan(req,res){ try{ const {IdPlandePrueba,IdPrueba}=req.body; const q=await pool.query('INSERT INTO "planDoPruebaCasoPrueba" ("IdPlandePrueba","IdPrueba") VALUES ($1,$2) RETURNING *',[IdPlandePrueba,IdPrueba]); res.status(201).json(q.rows[0]); }catch(e){console.error(e);res.status(500).json({message:'Error agregando caso al plan'})} }
export async function listPlanes(req,res){ try{ const q=await pool.query('SELECT p.*, u."Username" as "TesterName" FROM "planDoPrueba" p JOIN "Usuario" u ON u."IdUsuario"=p."IdTester" ORDER BY p."FechaEjecucion" DESC'); res.json(q.rows);}catch(e){console.error(e);res.status(500).json({message:'Error listando'})} }
export async function listPlanesForTester(req,res){ try{ const testerId = req.user.id; const q=await pool.query('SELECT * FROM "planDoPrueba" WHERE "IdTester"=$1 ORDER BY "FechaEjecucion" DESC',[testerId]); res.json(q.rows);}catch(e){console.error(e);res.status(500).json({message:'Error'})} }
export async function listCasosInPlan(req,res){ try{ const {id}=req.params; const q=await pool.query('SELECT c.* FROM "planDoPruebaCasoPrueba" p JOIN "casoPrueba" c ON c."IdPrueba"=p."IdPrueba" WHERE p."IdPlandePrueba"=$1 ORDER BY c."IdPrueba"',[id]); res.json(q.rows);}catch(e){console.error(e);res.status(500).json({message:'Error'})} }
