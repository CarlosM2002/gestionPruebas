import pool from '../config/db.js';
export async function registrarResultado(req,res){ try{ const {IdPlandePrueba,IdPrueba,EstadoPrueba,Observaciones,FechaEjecucion}=req.body; const q=await pool.query('INSERT INTO "ResultadoEjecucionPrueba" ("IdPlandePrueba","IdPrueba","EstadoPrueba","Observaciones","FechaEjecucion") VALUES ($1,$2,$3,$4,$5) RETURNING *',[IdPlandePrueba,IdPrueba,EstadoPrueba,Observaciones||null,FechaEjecucion]); res.status(201).json(q.rows[0]); }catch(e){console.error(e);res.status(500).json({message:'Error registrando resultado'})} }
export async function listarResultados(req,res){ try{ const q=await pool.query(`SELECT r.*, cp."Descripcion" as "CasoDesc", p."Descripcion" as "PlanDesc", u."Username" as "TesterName" FROM "ResultadoEjecucionPrueba" r JOIN "casoPrueba" cp ON cp."IdPrueba"=r."IdPrueba" JOIN "planDoPrueba" p ON p."IdPlandePrueba"=r."IdPlandePrueba" JOIN "Usuario" u ON u."IdUsuario"=p."IdTester" ORDER BY r."FechaEjecucion" DESC`); res.json(q.rows);}catch(e){console.error(e);res.status(500).json({message:'Error listando resultados'})} }
